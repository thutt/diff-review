#!/bin/bash
# Copyright (c) 2025  Logic Magicians Software.
# All Rights Reserved.
# Licensed under Gnu GPL V3.
#
#  This file declares a 'dr' and 'vr' shell alias for 'diff-review'
#  and 'view-review' respectively.  It provides direct access to the
#  utilities without having to modify PATH.
#
function readlinkf ()
{
    local target="$1";
    
    # Handle empty input
    if [ -z "$target" ]; then
        return 1;
    fi;
    
    # Use a subshell to avoid affecting current directory
    (
        if [ -d "$target" ]; then
            # Target is a directory - cd to it directly
            cd -P -- "$target" 2>/dev/null || exit 1;
            pwd -P;
        else
            # Target is a file - cd to its directory
            cd -P -- "$(dirname -- "$target")" 2>/dev/null || exit 1;
            printf '%s/%s\n' "$(pwd -P)" "$(basename -- "$target")";
        fi;
    ) || return 1;
}



sourced="0";          # False
BASH_MAJOR_VERSION=$(bash --version|head -n 1|awk '{print $4}'|cut -d '.' -f1);
if [[ ${BASH_MAJOR_VERSION} -lt 4 ]] ; then
    # Bash on MacOS is less than version 4.  Arrays are not supported.
    if [[ "${BASH_SOURCE}" != "${0}" ]]; then
        sourced="1";            # True
        filename="${0}";
    fi;
else
    if [[ "${BASH_SOURCE[0]}" != "${0}" ]]; then
        sourced="1";            # True
        filename="${BASH_SOURCE[0]}";
    fi;
fi;

if [[ "${sourced}" = "1" ]]; then
    script="$(readlinkf ${filename})";
    dir="$(readlinkf $(dirname "${script}")/..)";
    eval alias dr='${dir}/diff-review'
    eval alias vr='${dir}/view-review'
    eval alias vrt='${dir}/view-review-tabs'

    readlinkf "$(dirname ${script})/.."

    cat <<EOF

Provide direct access to 'diff-review':

  $(alias dr)


Provide direct access to 'view-review':

  $(alias vr)


Provide direct access to 'view-review-tabs':

  $(alias vrt)


EOF

else
    echo "This script cannot be executed.  It must be sourced.";
fi
