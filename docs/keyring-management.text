# Copyright (c) 2025  Logic Magicians Software (Taylor Hutt).
# All Rights Reserved.
# Licensed under Gnu GPL V3.
#
# This text generated by Claude.
#
================================================================================
KEYRING MANAGEMENT FOR DIFF_REVIEW
================================================================================

This document describes how to view, edit, and remove stored credentials
from the OS keyring on different platforms.

Service Name: diff-review-http-auth


================================================================================
LINUX
================================================================================

Method 1: Command Line (secret-tool)
-------------------------------------
Prerequisites:
  sudo apt install libsecret-tools

View all diff-review entries:
  secret-tool search service diff-review-http-auth

Remove credentials:
  secret-tool clear service diff-review-http-auth account username
  secret-tool clear service diff-review-http-auth account <actual-username>

Method 2: GUI (Seahorse - Passwords and Keys)
----------------------------------------------
Prerequisites:
  sudo apt install seahorse

Steps:
  1. Run: seahorse
  2. Search for "diff-review-http-auth"
  3. Right-click entries and select "Delete"

Alternative: Navigate to Login > Passwords and find entries manually

Method 3: Python
----------------
  python3 << 'EOF'
  import keyring
  # View username
  username = keyring.get_password("diff-review-http-auth", "username")
  print(f"Stored username: {username}")

  # Delete credentials
  if username:
      keyring.delete_password("diff-review-http-auth", username)
      keyring.delete_password("diff-review-http-auth", "username")
      print("Credentials deleted")
  EOF

Storage Location:
  ~/.local/share/keyrings/ (GNOME Keyring)
  KWallet location varies by distribution


================================================================================
MACOS
================================================================================

Method 1: GUI (Keychain Access)
--------------------------------
Steps:
  1. Open "Keychain Access.app" (in /Applications/Utilities/)
  2. Select "login" keychain in left sidebar
  3. Search for "diff-review-http-auth" in search box (top right)
  4. Select entries and press Delete key, or right-click > Delete

Method 2: Command Line (security)
----------------------------------
View credentials:
  security find-generic-password -s "diff-review-http-auth" -a "username" -w
  security find-generic-password -s "diff-review-http-auth" -a "<actual-username>" -w

Remove credentials:
  security delete-generic-password -s "diff-review-http-auth" -a "username"
  security delete-generic-password -s "diff-review-http-auth" -a "<actual-username>"

Method 3: Python
----------------
  python3 << 'EOF'
  import keyring
  username = keyring.get_password("diff-review-http-auth", "username")
  if username:
      keyring.delete_password("diff-review-http-auth", username)
      keyring.delete_password("diff-review-http-auth", "username")
      print("Credentials deleted")
  EOF

Storage Location:
  ~/Library/Keychains/login.keychain-db


================================================================================
WINDOWS
================================================================================

Method 1: GUI (Credential Manager)
-----------------------------------
Steps:
  1. Open Control Panel
  2. Navigate to: User Accounts > Credential Manager
  3. Click "Windows Credentials" tab
  4. Look for "Generic Credentials" section
  5. Find entries with "diff-review-http-auth"
  6. Click arrow to expand, then click "Remove"

Alternative Path:
  - Press Win+R, type: control /name Microsoft.CredentialManager
  - Or search Start menu for "Credential Manager"

Method 2: Command Line (cmdkey)
--------------------------------
List credentials:
  cmdkey /list

Remove credentials (if they appear):
  cmdkey /delete:diff-review-http-auth

Note: Generic credentials stored via Python keyring may not be visible
to cmdkey. Use GUI method or Python method instead.

Method 3: Python
----------------
  python << 'EOF'
  import keyring
  username = keyring.get_password("diff-review-http-auth", "username")
  if username:
      keyring.delete_password("diff-review-http-auth", username)
      keyring.delete_password("diff-review-http-auth", "username")
      print("Credentials deleted")
  EOF

Storage Location:
  Stored in Windows Credential Manager vault
  (encrypted system storage, no direct file access)


================================================================================
WSL2 (Windows Subsystem for Linux)
================================================================================

WSL2 credential storage depends on the keyring backend available:

Scenario 1: Using Native Linux Keyring
---------------------------------------
If gnome-keyring or similar is installed in WSL2, follow the LINUX
instructions above.

Check if keyring daemon is running:
  ps aux | grep gnome-keyring

Start keyring daemon if needed:
  eval $(gnome-keyring-daemon --start --components=secrets)

Then use Linux methods (secret-tool, seahorse, or Python).

Scenario 2: Using Windows Credential Manager Bridge
----------------------------------------------------
Some WSL2 setups bridge to Windows Credential Manager. In this case:
  1. Check Windows Credential Manager (see Windows section above)
  2. Or use Python method within WSL2

Scenario 3: Fallback Encrypted File
------------------------------------
If no system keyring is available, Python keyring creates an encrypted
file at:
  ~/.local/share/python_keyring/

To remove credentials:
  rm -rf ~/.local/share/python_keyring/

Note: This removes ALL keyring entries, not just diff-review.

Python Method (works in all scenarios):
  python3 << 'EOF'
  import keyring
  username = keyring.get_password("diff-review-http-auth", "username")
  if username:
      keyring.delete_password("diff-review-http-auth", username)
      keyring.delete_password("diff-review-http-auth", "username")
      print("Credentials deleted")
  EOF


================================================================================
UPDATING CREDENTIALS (ALL PLATFORMS)
================================================================================

To update stored credentials (e.g., after password change):

Option 1: Delete and Re-enter
------------------------------
  1. Delete existing credentials using platform-specific method above
  2. Run diff_review
  3. Enter new credentials when prompted
  4. Check "Remember credentials" checkbox

Option 2: Use Python to Update Directly
----------------------------------------
  python3 << 'EOF'
  import keyring

  # Set new credentials
  new_username = "your-username"
  new_password = "your-new-password"

  keyring.set_password("diff-review-http-auth", "username", new_username)
  keyring.set_password("diff-review-http-auth", new_username, new_password)

  print("Credentials updated")
  EOF


================================================================================
DISABLING KEYRING FEATURE
================================================================================

If you prefer not to use keyring storage at all:

Command Line Option:
  diff_review --no-keyring <other-args>

This disables keyring storage even if the keyring library is installed.
Credentials will only be cached for the current session.


================================================================================
TROUBLESHOOTING
================================================================================

Credentials Not Persisting (Linux)
-----------------------------------
Check if keyring daemon is running:
  ps aux | grep gnome-keyring

If not running, start it:
  killall -q gnome-keyring-daemon 2>/dev/null
  eval $(gnome-keyring-daemon --start --components=secrets)

Test keyring functionality:
  python3 -c "import keyring; keyring.set_password('test','user','pass'); print('OK')"

Keyring Prompting for Password (Linux)
---------------------------------------
The default login keyring may be locked. Unlock it:
  1. Open seahorse (Passwords and Keys)
  2. Right-click "Login" keyring
  3. Select "Unlock"
  4. Enter your login password

Or set it to unlock automatically on login in keyring settings.

Permission Denied (macOS)
--------------------------
Grant Terminal or your app permission to access Keychain:
  1. System Preferences > Security & Privacy > Privacy
  2. Select "Automation" or "Full Disk Access"
  3. Add your terminal or application

Cannot Find Credentials (Windows)
----------------------------------
Generic credentials may be stored under different scope. Try:
  1. Look in both "Windows Credentials" and "Generic Credentials"
  2. Use Python method to delete since cmdkey may not see them
